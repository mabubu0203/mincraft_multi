version: "3.8"

services:
  mc-vanilla:
    image: itzg/minecraft-server:latest
    container_name: "mc-vanilla"
    tty: true
    stdin_open: true
    ports:
      - 25565:25565
      - 19132:19132/udp
    environment:
      SERVER_NAME: "u-server-01"
      GAMEMODE: "survival"
      DIFFICULTY: "easy"
      MAX_PLAYERS: 15
      LEVEL_TYPE: "default"
      LEVEL_NAME: "world"
      EULA: "TRUE"
      TYPE: "SPIGOT"
      VERSION: "1.18.2"
      MEMORY: 2G
      TZ: "Asia/Tokyo"
    volumes:
      - "./data:/data"
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 3G

  # Backup
  backup:
    image: itzg/mc-backup
    depends_on:
    - mc-vanilla
    volumes:
      - ./data:/data:ro
      - ./mc-backups:/backups
      - /etc/timezone:/etc/timezone:ro
    network_mode: "service:mc-vanilla"